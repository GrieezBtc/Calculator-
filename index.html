<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pro Calculator + Live NGN Converter</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --panel-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
            --btn-num: #e9ecef;
        }

        .dark-mode {
            --bg-gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            --panel-bg: rgba(30, 30, 40, 0.95);
            --text-color: #ecf0f1;
            --btn-num: #34495e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg-gradient);
            padding: 20px;
            color: var(--text-color);
        }

        .calculator {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            border-radius: 20px;
            background: var(--panel-bg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .display-container { position: relative; margin-bottom: 15px; }

        input[type="text"] {
            width: 100%;
            height: 80px;
            font-size: 32px;
            padding: 10px;
            text-align: right;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: #f8f9fa;
            color: #333;
        }

        .dark-mode input[type="text"] { background: #2c3e50; color: #fff; border-color: #444; }

        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        
        button {
            height: 55px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            transition: 0.2s;
        }

        button:active { transform: scale(0.95); }

        .num { background: var(--btn-num); color: var(--text-color); }
        .op { background: #ff9500; color: white; }
        .fn { background: #a6a6a6; color: white; }
        .eq { background: #007aff; color: white; grid-column: span 1; }
        .zero { grid-column: span 2; }

        .scientific-btns, .converter-panel { display: none; margin-bottom: 15px; }
        .scientific-mode .scientific-btns { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .converter-mode .converter-panel { display: block; }

        .mode-ctrl { display: flex; gap: 5px; margin-bottom: 15px; justify-content: space-between; }
        .mode-btn { padding: 8px; flex: 1; background: #eee; font-size: 14px; }
        .mode-btn.active { background: #007aff; color: white; }

        .conv-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        select, .conv-input { padding: 8px; border-radius: 5px; width: 100%; }
    </style>
</head>
<body>

    <div class="calculator" id="mainCalc">
        <div class="mode-ctrl">
            <button class="mode-btn active" onclick="setMode('basic')">Basic</button>
            <button class="mode-btn" onclick="setMode('scientific')">Sci</button>
            <button class="mode-btn" onclick="setMode('converter')">Conv</button>
            <button class="mode-btn" onclick="toggleTheme()" style="max-width: 40px;">ðŸŒ™</button>
        </div>

        <div class="scientific-btns">
            <button class="num" onclick="press('Math.sin(')">sin</button>
            <button class="num" onclick="press('Math.cos(')">cos</button>
            <button class="num" onclick="press('Math.sqrt(')">âˆš</button>
            <button class="num" onclick="press('**')">^</button>
            <button class="num" onclick="press('Math.PI')">Ï€</button>
        </div>

        <div class="converter-panel">
            <input type="number" id="unitInput" class="conv-input" value="1" oninput="convert()">
            <div class="conv-row">
                <select id="unitFrom" onchange="convert()"></select>
                <select id="unitTo" onchange="convert()"></select>
            </div>
            <p id="unitRes" style="text-align:center; margin-top:10px; font-weight:bold;"></p>
        </div>

        <div class="display-container">
            <input type="text" id="scr" readonly placeholder="0">
        </div>

        <div class="btn-grid">
            <button class="fn" onclick="clr()">C</button>
            <button class="fn" onclick="del()">DEL</button>
            <button class="fn" onclick="press('%')">%</button>
            <button class="op" onclick="press('/')">Ã·</button>
            
            <button class="num" onclick="press('7')">7</button>
            <button class="num" onclick="press('8')">8</button>
            <button class="num" onclick="press('9')">9</button>
            <button class="op" onclick="press('*')">Ã—</button>
            
            <button class="num" onclick="press('4')">4</button>
            <button class="num" onclick="press('5')">5</button>
            <button class="num" onclick="press('6')">6</button>
            <button class="op" onclick="press('-')">-</button>
            
            <button class="num" onclick="press('1')">1</button>
            <button class="num" onclick="press('2')">2</button>
            <button class="num" onclick="press('3')">3</button>
            <button class="op" onclick="press('+')">+</button>
            
            <button class="num zero" onclick="press('0')">0</button>
            <button class="num" onclick="press('.')">.</button>
            <button class="eq" onclick="solve()">=</button>
        </div>
    </div>

    <script>
        let screen = document.getElementById('scr');
        let rates = { "NGN": 1, "USD": 0.00065, "GBP": 0.0005, "EUR": 0.0006 };

        // 1. Live Currency Fetch
        async function getLiveRates() {
            try {
                const response = await fetch('https://open.er-api.com/v6/latest/NGN');
                const data = await response.json();
                if(data.rates) {
                    rates = data.rates;
                    initConverter();
                }
            } catch(e) { console.log("Offline: Using fallback rates"); initConverter(); }
        }
        getLiveRates();

        // 2. Calculator Logic
        function press(v) { screen.value += v; }
        function clr() { screen.value = ''; }
        function del() { screen.value = screen.value.slice(0, -1); }
        function solve() {
            try {
                // Handle scientific closing brackets automatically if missing
                let val = screen.value;
                let openBrackets = (val.match(/\(/g) || []).length;
                let closeBrackets = (val.match(/\)/g) || []).length;
                while(openBrackets > closeBrackets) { val += ')'; closeBrackets++; }
                
                screen.value = eval(val);
            } catch(e) { screen.value = 'Error'; }
        }

        // 3. Theme & Modes
        function toggleTheme() { document.body.classList.toggle('dark-mode'); }
        
        function setMode(mode) {
            const calc = document.getElementById('mainCalc');
            calc.classList.remove('scientific-mode', 'converter-mode');
            if(mode !== 'basic') calc.classList.add(mode + '-mode');
            
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if(mode === 'converter') initConverter();
        }

        // 4. Converter Logic
        function initConverter() {
            const from = document.getElementById('unitFrom');
            const to = document.getElementById('unitTo');
            const options = Object.keys(rates).map(r => `<option value="${r}">${r}</option>`).join('');
            from.innerHTML = to.innerHTML = options;
            from.value = "USD";
            to.value = "NGN";
            convert();
        }

        function convert() {
            const amt = document.getElementById('unitInput').value;
            const f = document.getElementById('unitFrom').value;
            const t = document.getElementById('unitTo').value;
            const res = (amt / rates[f]) * rates[t];
            document.getElementById('unitRes').innerText = `${amt} ${f} = ${res.toLocaleString(undefined, {minimumFractionDigits: 2})} ${t}`;
        }
    </script>
</body>
</html>
