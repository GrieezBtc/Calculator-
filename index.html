<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <title>Pro Calc & Currency</title>
  
  <meta name="theme-color" content="#fbaf00">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Pro%20Calculator%22,%22short_name%22:%22ProCalc%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#ffffff%22,%22theme_color%22:%22#fbaf00%22}">

  <style>
    :root {
      --bg-body: #f0f2f5;
      --bg-calc: #ffffff;
      --bg-display: #f8f9fa;
      --text-main: #202124;
      --btn-bg: #f1f3f4;
      --accent: #fbaf00;
      --success: #34a853;
      --error: #ea4335;
    }

    [data-theme="dark"] {
      --bg-body: #121212;
      --bg-calc: #202124;
      --bg-display: #2d2e31;
      --text-main: #e8eaed;
      --btn-bg: #3c4043;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, sans-serif; }

    body {
      background-color: var(--bg-body);
      height: 100dvh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden; /* Prevents whole screen scrolling */
    }

    .app-container {
      width: 100%;
      max-width: 420px;
      height: 100%;
      max-height: 850px;
      background: var(--bg-calc);
      display: flex;
      flex-direction: column;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 15px;
    }

    @media (min-width: 420px) {
      .app-container { height: 95dvh; border-radius: 30px; }
    }

    /* Nav bar */
    .nav {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }

    .nav button {
      flex: 1;
      padding: 10px 5px;
      border: none;
      border-radius: 12px;
      background: var(--btn-bg);
      color: var(--text-main);
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .nav button.active { background: var(--accent); color: white; }

    /* Display Area */
    #screen {
      background: var(--bg-display);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-end;
      min-height: 140px;
    }

    #preview { font-size: 1rem; color: #888; margin-bottom: 5px; min-height: 1.2rem; }
    #main-input { 
      font-size: 2.5rem; 
      color: var(--text-main); 
      word-break: break-all;
      text-align: right;
    }

    /* Button Grids */
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      flex: 1;
    }

    #sci-grid { display: none; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
    #sci-grid.active { display: grid; }

    button.key {
      border: none;
      border-radius: 18px;
      background: var(--btn-bg);
      color: var(--text-main);
      font-size: 1.3rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.1s;
    }

    button.key:active { opacity: 0.6; }
    .op { color: var(--accent); font-weight: 700; }
    .eq { background: var(--success) !important; color: white; grid-column: span 2; border-radius: 35px; }
    .clr { background: var(--error) !important; color: white; }
    .sci-key { font-size: 0.9rem; background: #e8f0fe; color: #1a73e8; }
    [data-theme="dark"] .sci-key { background: #1a273a; color: #8ab4f8; }

    /* Panels */
    .panel {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-calc);
      z-index: 100;
      display: none;
      flex-direction: column;
      padding: 20px;
    }

    .panel.active { display: flex; }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .hist-item { padding: 15px; border-bottom: 1px solid var(--btn-bg); text-align: right; color: var(--text-main); }

    /* Currency Mode styling */
    #conv-mode { display: none; flex-direction: column; gap: 15px; }
    #conv-mode.active { display: flex; }
    .curr-row { display: flex; gap: 10px; }
    input.curr, select { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid var(--btn-bg); background: var(--bg-display); color: var(--text-main); font-size: 1rem; }
  </style>
</head>
<body data-theme="light">

<div class="app-container">
  <div class="nav">
    <button id="tab-calc" class="active" onclick="setMode('calc')">Calculator</button>
    <button id="tab-conv" onclick="setMode('conv')">Currency</button>
    <button onclick="toggleSci()">ðŸ§ª Sci</button>
    <button onclick="toggleHistory(true)">ðŸ“œ</button>
    <button onclick="toggleTheme()">ðŸŒ™</button>
  </div>

  <div id="calc-mode" style="display: contents;">
    <div id="screen">
      <div id="preview"></div>
      <div id="main-input">0</div>
    </div>

    <div id="sci-grid">
      <button class="key sci-key" onclick="pressSci('Math.sin(')">sin</button>
      <button class="key sci-key" onclick="pressSci('Math.cos(')">cos</button>
      <button class="key sci-key" onclick="pressSci('Math.sqrt(')">âˆš</button>
      <button class="key sci-key" onclick="press('**')">xÊ¸</button>
    </div>

    <div class="grid">
      <button class="key clr" onclick="cls()">C</button>
      <button class="key" onclick="del()">âŒ«</button>
      <button class="key op" onclick="press('%')">%</button>
      <button class="key op" onclick="press('/')">Ã·</button>
      
      <button class="key" onclick="press('7')">7</button>
      <button class="key" onclick="press('8')">8</button>
      <button class="key" onclick="press('9')">9</button>
      <button class="key op" onclick="press('*')">x</button>
      
      <button class="key" onclick="press('4')">4</button>
      <button class="key" onclick="press('5')">5</button>
      <button class="key" onclick="press('6')">6</button>
      <button class="key op" onclick="press('-')">-</button>
      
      <button class="key" onclick="press('1')">1</button>
      <button class="key" onclick="press('2')">2</button>
      <button class="key" onclick="press('3')">3</button>
      <button class="key op" onclick="press('+')">+</button>
      
      <button class="key" onclick="press('0')">0</button>
      <button class="key" onclick="press('.')">.</button>
      <button class="key eq" onclick="run()">=</button>
    </div>
  </div>

  <div id="conv-mode">
    <div id="screen" style="min-height: 200px; justify-content: center; align-items: stretch;">
      <div class="curr-row">
        <input type="number" id="amt" class="curr" value="1" oninput="convert()">
        <select id="from" onchange="convert()">
          <option value="NGN">NGN</option>
          <option value="USD" selected>USD</option>
          <option value="EUR">EUR</option>
        </select>
      </div>
      <div style="text-align: center; margin: 10px 0; color: var(--accent); cursor: pointer;" onclick="swap()">â‡… SWAP</div>
      <div class="curr-row">
        <input type="text" id="res" class="curr" readonly>
        <select id="to" onchange="convert()">
          <option value="NGN" selected>NGN</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
        </select>
      </div>
      <p id="rate-info" style="font-size: 0.7rem; text-align: center; margin-top: 10px; color: #888;">Live rates active</p>
    </div>
  </div>

  <div id="hist-panel" class="panel">
    <div class="panel-header">
      <h2>History</h2>
      <button class="nav" style="width: auto;" onclick="toggleHistory(false)">Close âœ•</button>
    </div>
    <div id="hist-list" style="overflow-y: auto; flex: 1;"></div>
    <button class="key op" style="margin-top: 10px; padding: 15px;" onclick="clearHist()">Clear All</button>
  </div>

</div>

<script>
  let currentInput = "0";
  let history = [];

  function setMode(m) {
    document.getElementById('calc-mode').style.display = m === 'calc' ? 'contents' : 'none';
    document.getElementById('conv-mode').classList.toggle('active', m === 'conv');
    document.getElementById('tab-calc').classList.toggle('active', m === 'calc');
    document.getElementById('tab-conv').classList.toggle('active', m === 'conv');
    if(m === 'conv') convert();
  }

  function toggleTheme() {
    const b = document.body;
    b.setAttribute('data-theme', b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
  }

  function toggleSci() { document.getElementById('sci-grid').classList.toggle('active'); }
  function toggleHistory(show) { document.getElementById('hist-panel').classList.toggle('active', show); }

  function press(v) {
    if(currentInput === "0" && !isNaN(v)) currentInput = v;
    else currentInput += v;
    update();
  }

  function pressSci(f) {
    if(currentInput === "0") currentInput = f;
    else currentInput += f;
    update();
  }

  function cls() { currentInput = "0"; document.getElementById('preview').innerText = ""; update(); }
  function del() { currentInput = currentInput.length > 1 ? currentInput.slice(0, -1) : "0"; update(); }

  function update() { 
    document.getElementById('main-input').innerText = currentInput.replace(/\*/g, 'x').replace(/Math\./g, ''); 
  }

  function run() {
    try {
      let expr = currentInput;
      let result = eval(expr);
      document.getElementById('preview').innerText = currentInput.replace(/\*/g, 'x') + " =";
      
      history.unshift(`${currentInput.replace(/\*/g, 'x')} = ${result}`);
      renderHistory();
      
      currentInput = result.toString();
      update();
    } catch {
      document.getElementById('main-input').innerText = "Error";
      setTimeout(cls, 1500);
    }
  }

  async function convert() {
    const a = document.getElementById('amt').value;
    const f = document.getElementById('from').value;
    const t = document.getElementById('to').value;
    if(!a) return;
    try {
      const r = await fetch(`https://open.er-api.com/v6/latest/${f}`);
      const d = await r.json();
      document.getElementById('res').value = (a * d.rates[t]).toLocaleString(undefined, {maximumFractionDigits: 2});
    } catch { document.getElementById('res').value = "Offline"; }
  }

  function swap() {
    const f = document.getElementById('from');
    const t = document.getElementById('to');
    const temp = f.value; f.value = t.value; t.value = temp;
    convert();
  }

  function renderHistory() {
    document.getElementById('hist-list').innerHTML = history.map(h => `<div class="hist-item">${h}</div>`).join('');
  }

  function clearHist() { history = []; renderHistory(); }
</script>

</body>
</html>
